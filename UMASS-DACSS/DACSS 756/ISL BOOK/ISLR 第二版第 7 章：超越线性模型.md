# ISLR 第二版第 7 章：超越线性模型

## 7.1 多项式回归（Polynomial Regression）

### 7.1.1 模型形式
多项式回归通过引入自变量的高次项来捕捉非线性关系：

$$y_i = \beta_0 + \beta_1 x_i + \beta_2 x_i^2 + \dots + \beta_d x_i^d + \epsilon_i$$

其中：
- $d$ 是多项式的阶数
- $\beta_j$ 是回归系数
- $\epsilon_i$ 是误差项

### 7.1.2 正交多项式
为避免数值计算问题，通常使用正交多项式：

$$y_i = \beta_0 + \sum_{j=1}^d \beta_j \phi_j(x_i) + \epsilon_i$$

其中 $\phi_j(x)$ 是正交多项式基函数。

## 7.2 阶梯函数（Step Functions）

### 7.2.1 模型形式
使用指示函数将连续变量分段：

$$y_i = \beta_0 + \sum_{k=1}^K \beta_k I(c_k \leq x_i < c_{k+1}) + \epsilon_i$$

其中：
- $I(\cdot)$ 是指示函数
- $c_k$ 是切点（breakpoints）

## 7.3 回归样条（Regression Splines）

### 7.3.1 截断幂基函数
三次样条的基函数形式：

$$y_i = \beta_0 + \beta_1 x_i + \beta_2 x_i^2 + \beta_3 x_i^3 + \sum_{k=1}^K \gamma_k (x_i - \xi_k)_+^3 + \epsilon_i$$

其中：
- $(x - \xi_k)_+^3$ 是截断幂基函数
- $\xi_k$ 是结点（knots）

### 7.3.2 B样条基
更稳定的基函数表示：

$$f(x) = \sum_{j=1}^K \beta_j B_j(x)$$

其中 $B_j(x)$ 是B样条基函数。

## 7.4 平滑样条（Smoothing Splines）

### 7.4.1 优化问题
平滑样条通过最小化惩罚的残差平方和：

$$\min_g \left\{\sum_{i=1}^n (y_i - g(x_i))^2 + \lambda \int g''(t)^2 dt\right\}$$

其中：
- $\lambda \geq 0$ 是平滑参数
- $\int g''(t)^2 dt$ 是粗糙度惩罚项

### 7.4.2 自由度
平滑参数 $\lambda$ 与有效自由度（effective degrees of freedom, df）的关系：
- $\lambda = 0$ 时，df = n
- $\lambda \to \infty$ 时，df = 2

## 7.5 局部回归（Local Regression）

### 7.5.1 加权最小二乘
对每个点 $x_0$，求解：

$$\min_{\beta_0, \beta_1} \sum_{i=1}^n K_\lambda(x_0, x_i)(y_i - \beta_0 - \beta_1(x_i - x_0))^2$$

其中：
- $K_\lambda(\cdot)$ 是核函数
- $\lambda$ 是带宽参数

### 7.5.2 局部多项式
可扩展到更高阶多项式：

$$\min_{\beta_0, \beta_1, ..., \beta_d} \sum_{i=1}^n K_\lambda(x_0, x_i)(y_i - \sum_{j=0}^d \beta_j(x_i - x_0)^j)^2$$

## 7.6 广义加法模型（GAMs）

### 7.6.1 基本形式
GAM将每个预测变量的影响表示为非参数函数：

$$y_i = \beta_0 + \sum_{j=1}^p f_j(x_{ij}) + \epsilon_i$$

其中：
- $f_j$ 是平滑函数
- $\epsilon_i \sim N(0, \sigma^2)$

### 7.6.2 扩展形式
可以结合参数和非参数项：

$$y_i = \beta_0 + \sum_{j=1}^{p_1} \beta_j x_{ij} + \sum_{k=1}^{p_2} f_k(x_{ik}) + \epsilon_i$$

## 7.7 模型选择与诊断

### 7.7.1 平滑参数选择
使用交叉验证选择平滑参数：

$$CV(\lambda) = \sum_{i=1}^n (y_i - \hat{f}_\lambda^{(-i)}(x_i))^2$$

其中 $\hat{f}_\lambda^{(-i)}$ 是去除第 i 个观测后的拟合。

### 7.7.2 模型比较
使用ANOVA进行模型比较：

$$RSS_0 - RSS_1 \sim \chi^2_{df_1 - df_0}$$

## 7.8 实践建议

### 7.8.1 方法选择
1. **多项式回归**：
   - 优点：简单、易实现
   - 适用：简单非线性关系

2. **样条方法**：
   - 优点：灵活、有理论保证
   - 适用：复杂非线性关系

3. **局部回归**：
   - 优点：完全非参数
   - 缺点：计算密集

4. **GAMs**：
   - 优点：灵活性与解释性结合
   - 适用：多变量非线性关系

### 7.8.2 注意事项
1. **过拟合防护**：
   - 使用交叉验证选择参数
   - 考虑使用正则化

2. **计算效率**：
   - 样本量大时考虑计算成本
   - 选择适当的方法平衡效率和精度

3. **可解释性**：
   - GAMs提供良好的可视化
   - 考虑模型复杂度与解释性的平衡

## 7.9 总结

### 关键点
1. 非线性建模提供了比线性模型更大的灵活性
2. 不同方法各有优势，需根据具体问题选择
3. 模型选择和诊断是关键步骤
4. 平衡模型复杂度和可解释性

### 方法比较
| 方法       | 优点       | 缺点       | 适用场景   |
| ---------- | ---------- | ---------- | ---------- |
| 多项式回归 | 简单       | 边界不稳定 | 简单非线性 |
| 样条       | 灵活       | 需选择结点 | 一般非线性 |
| 局部回归   | 完全非参数 | 计算密集   | 光滑趋势   |
| GAMs       | 可解释性强 | 复杂度高   | 多变量分析 |