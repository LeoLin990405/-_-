# 第13章：多重假设检验

## 13.1 假设检验回顾

### 13.1.1 假设检验基础

单个假设检验的统计量：

双样本t检验统计量：
$$T = \frac{\hat{\mu}_1 - \hat{\mu}_2}{s\sqrt{\frac{1}{n_1} + \frac{1}{n_2}}}$$

Type I error概率：
$$\alpha = P(\text{拒绝}H_0|H_0\text{为真})$$

Type II error概率：
$$\beta = P(\text{接受}H_0|H_0\text{为假})$$

### 13.1.2 检验力计算
检验力定义：
$$\text{Power} = 1 - \beta = P(\text{拒绝}H_0|H_0\text{为假})$$

## 13.2 多重检验的误差控制

### 13.2.1 族错误率（FWER）

$$FWER = P(\text{至少有一个错误拒绝})$$

### 13.2.2 虚假发现率（FDR）

$$FDR = E\left(\frac{V}{R}|R>0\right)P(R>0)$$

其中：
- $V$ 是错误拒绝数量
- $R$ 是总拒绝数量

## 13.3 FWER控制方法

### 13.3.1 Bonferroni校正

对每个检验使用调整后的显著性水平：

$$\alpha_{adj} = \frac{\alpha}{m}$$

其中：
- $\alpha$ 是整体显著性水平
- $m$ 是检验总数

### 13.3.2 Holm步骤法
调整后的p值：

$$p_{adj,(i)} = \max_{j\leq i}\{\min((m-j+1)p_{(j)}, 1)\}$$

## 13.4 FDR控制方法

### 13.4.1 Benjamini-Hochberg (BH)程序

BH阈值计算：

$$k = \max\{i: p_{(i)} \leq \frac{i}{m}q\}$$

调整后的p值：

$$p_{adj,(i)} = \min\{\min_{j\geq i}(\frac{m}{j}p_{(j)}), 1\}$$

### 13.4.2 Storey's q-value
q-value计算：

$$\hat{q}(p) = \min_{t\geq p}\{\frac{\hat{\pi}_0 m t}{R(t)}\}$$

其中：
- $\hat{\pi}_0$ 是真零假设比例的估计
- $R(t)$ 是p值小于t的检验数量

## 13.5 重抽样方法

### 13.5.1 Permutation测试
p值计算：

$$p = \frac{\sum_{b=1}^B I(|T_b^*| \geq |T_{obs}|)}{B}$$

其中：
- $T_b^*$ 是第b次重抽样的检验统计量
- $T_{obs}$ 是观测到的检验统计量

### 13.5.2 Bootstrap FDR估计

$$\widehat{FDR}(t) = \frac{\hat{V}(t)}{\max(R(t), 1)}$$

其中 $\hat{V}(t)$ 是通过bootstrap估计的假阳性数量

## 13.6 多重检验的诊断

### 13.6.1 p值分布诊断
均匀性检验：

$$\chi^2 = \sum_{i=1}^k \frac{(O_i - E_i)^2}{E_i}$$

### 13.6.2 效应量估计的收缩

James-Stein收缩估计：

$$\hat{\theta}_i^{JS} = (1-B)\hat{\theta}_i + B\bar{\theta}$$

其中：
- $B$ 是收缩因子
- $\bar{\theta}$ 是效应量的平均值

## 13.7 实践建议

### 13.7.1 方法选择
1. **小规模多重检验**：
   - 使用FWER控制（Bonferroni或Holm）
   - 重点控制Type I错误

2. **大规模多重检验**：
   - 使用FDR控制（BH或q-value）
   - 平衡Type I和Type II错误

### 13.7.2 数据预处理
1. **过滤无意义的检验**
2. **标准化和转换**
3. **相关性结构考虑**

## 13.8 总结

### 13.8.1 方法比较
| 方法       | 控制类型 | 优点 | 缺点       |
| ---------- | -------- | ---- | ---------- |
| Bonferroni | FWER     | 简单 | 保守       |
| Holm       | FWER     | 较强 | 计算复杂   |
| BH         | FDR      | 灵活 | 依赖独立性 |
| q-value    | FDR      | 精确 | 计算密集   |

### 13.8.2 应用场景
1. 基因表达分析
2. 神经影像学
3. 社会科学研究
4. 临床试验
5. 机器学习特征选择

### 13.8.3 未来发展
1. 考虑依赖结构
2. 整合先验信息
3. 自适应过程
4. 计算效率优化