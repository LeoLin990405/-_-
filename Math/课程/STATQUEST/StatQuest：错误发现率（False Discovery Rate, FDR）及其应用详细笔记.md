# **StatQuest：错误发现率（False Discovery Rate, FDR）及其应用详细笔记**

---

## **1. 什么是错误发现率（False Discovery Rate, FDR）？**

- **错误发现率（FDR）**是一种**多重检验校正方法**，用于控制多次假设检验中**假阳性（False Positive）**的比例。  
- **假阳性**：原假设（$H_0$）成立时，错误地认为结果有显著性差异，即$p < 0.05$。  
- **FDR的作用**：在大量假设检验中确保被判为显著的结果大多数为真实显著，避免虚假的显著性误导研究。

---

## **2. 为什么需要FDR校正？**

### **2.1 多重比较问题（Multiple Testing Problem）**

- 在**多次测试**时，每次假设检验都有$5\%$的概率出现**假阳性**。  
- **示例**：对于$10,000$个基因的假设检验，若所有基因都不受药物影响，仍可能有：
  $$
  10,000 \times 0.05 = 500 \, \text{个假阳性}
  $$
- 因此，我们需要**校正p值**，避免虚假的显著性误导结论。

---

## **3. Benjamini-Hochberg校正法：FDR常用算法**

### **3.1 Benjamini-Hochberg校正步骤**

1. **收集所有p值**：  
   - 从所有假设检验中获取p值，记为：
     $$
     p_1, p_2, \dots, p_n
     $$

2. **对p值从小到大排序**：  
   - 排序后的p值满足：
     $$
     p_{(1)} \leq p_{(2)} \leq \dots \leq p_{(n)}
     $$

3. **计算每个p值的调整值**：  
   - 对于第$i$个排序后的p值，计算：
     $$
     p_{\text{调整}}(i) = \min\left(\frac{p_{(i)} \cdot n}{i}, 1\right)
     $$
   - 其中$n$是所有p值的总数，$i$表示排序后的位置。

4. **逐步校正以确保p值递增**：  
   - 从最大的p值开始，逐步向前校正，确保p值的单调递增：
     $$
     p_{\text{调整}}(i) = \min\left(p_{\text{调整}}(i+1), \frac{p_{(i)} \cdot n}{i}\right)
     $$

---

## **4. 示例：基因表达分析中的FDR校正**

1. **实验设计**：  
   - **控制组**和**药物组**，每组中比较10,000个基因的表达水平。

2. **计算未校正的p值**：  
   - 每个基因的p值表示它在两组间表达水平的显著性差异。

3. **FDR校正步骤**：
   - 对所有10,000个p值进行Benjamini-Hochberg校正。
   - 计算每个基因的FDR调整后p值。

4. **解读结果**：  
   - 校正后，只有$p_{\text{调整}} < 0.05$的基因被认为显著。

---

## **5. FDR校正与p值的关系**

1. **未经校正的p值**可能在多重测试中导致**大量假阳性**。  
2. **FDR校正**确保我们判定为显著的结果大多数为真实显著，避免虚假结论。

---

## **6. FDR的优缺点**

### **6.1 优点**

- **减少假阳性风险**：在大量测试中控制错误发现的比例。  
- **灵活性高**：适用于**基因组学**等大规模数据分析。

### **6.2 缺点**

- **部分真实显著结果可能被忽略**：校正后部分显著结果可能失去显著性。  
- **保守性增加**：校正后的显著性判断较为严格。

---

## **7. FDR校正与功效分析（Power Analysis）**

1. **功效分析的目的**：  
   - 在实验设计阶段确定**所需样本量**，避免在实验过程中滥用p值或增加样本进行p-hacking。

2. **功效分析步骤**：  
   - 设定**显著性水平**（通常为0.05）。  
   - 设定**预期效果大小（Effect Size）**和**检验功效（Power）**（通常为0.8）。  
   - 根据以上参数计算所需样本量。

---

## **8. 如何避免p-hacking并正确使用FDR**

1. **透明化数据处理与报告**：  
   - 报告所有检验结果，而不仅仅是显著结果。

2. **使用FDR校正p值**：  
   - 避免多重测试导致假阳性。

3. **提前规划实验设计**：  
   - 在实验开始前进行功效分析，避免随意增加样本导致误导性结果。

---

## **9. 数学推导：FDR校正的原理**

- FDR校正保证显著性检验的**错误发现率控制在预设范围内**。
- Benjamini-Hochberg校正的公式：
  $$
  p_{\text{调整}}(i) = \min\left(\frac{p_{(i)} \cdot n}{i}, p_{\text{调整}}(i+1)\right)
  $$
  - 该公式确保p值在排序后依次递增。

---

## **10. 总结：如何正确使用FDR**

1. **适用场景**：  
   - FDR适用于**大规模、多重假设检验**的场景，如基因表达分析。

2. **选择适当的校正方法**：  
   - Benjamini-Hochberg校正是一种常用且有效的FDR校正方法。

3. **报告校正后的p值**：  
   - 确保结果透明化，避免选择性报告。

---

## **11. 最后的话：Quest On!**

- 使用**错误发现率（FDR）**进行校正，可以有效减少多重测试中的假阳性。  
- 如果你喜欢本次StatQuest并希望学习更多内容，请**订阅**我们的频道！  
- 有任何问题或建议，请在**评论区留言**！

---

**Quest On!** 🎯