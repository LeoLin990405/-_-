### 详细笔记：Nim游戏中的Nim值与Mex规则

这份笔记详细介绍了Nim游戏中的Nim值（Nim Value）和Mex（Minimum Excludant）规则，并通过公式与实例的推导帮助理解这些概念。目标是为本科生自学提供清晰、系统的讲解。

---

#### 1. Nim游戏的基本规则

- **Nim游戏简介**：
  - Nim游戏是一种经典的组合博弈问题。假设有一堆或多堆筹码，玩家轮流从任一堆中取走至少一枚筹码，取完最后一枚筹码的玩家获胜。
  - 如果存在多个堆，游戏仍然按照轮流取筹码的规则进行，但每轮只能从一堆中取。
  - 游戏的目标是**迫使对方进入无合法操作的状态**，即让对方无法进行有效操作，从而输掉游戏。

- **Nim值的基本定义**：
  - 在Nim游戏中，每一个局面都有一个数值叫做**Nim值**，用来表示该局面的获胜可能性。Nim值是该局面在最优策略下的一个标识。
  - 对于含有 $n$ 个筹码的单一堆局面 $G \equiv *(n)$，定义其Nim值为 $n$，记作 $N(G) = n$。这意味着如果只剩下一堆 $n$ 个筹码，则该局面的Nim值为 $n$。
  - **基准条件**：如果某个局面没有任何合法的操作选择（即筹码已经取完），则定义其Nim值为 $0$，记作 $N(G) = 0$。这是Nim值计算的基础。

---

#### 2. Nim值的作用——判定胜负

- **胜局与输局**：
  - Nim值的核心在于判定当前局面对先手玩家（第一个行动的玩家）是否有利。定义如下：
    - **输局**：如果某局面的Nim值 $N(G) = 0$，称该局面为“输局”。在输局中，无论先手如何操作，都无法获胜。
    - **赢局**：如果 $N(G) > 0$，称该局面为“赢局”。在赢局中，先手通过最优策略可以保证获胜。

- **胜负判定公式**：
  - 使用Nim值，我们可以用下述公式判断当前局面的胜负
    $$
    W(G) = 
    \begin{cases}
        0, & \text{if } N(G) = 0 \\
        1, & \text{if } N(G) > 0
    \end{cases}
    $$
  - 其中 $W(G)$ 表示局面 $G$ 的胜负情况，$W(G) = 0$ 表示输局，$W(G) = 1$ 表示赢局。

- **为什么Nim值能够决定胜负？**
  - 当 $N(G) = 0$ 时，先手玩家会将对手带入赢局的状态，自己会进入被动的局面。这就是Nim游戏的特殊性质——Nim值能够准确判定每个局面的胜负。

---

#### 3. Mex（Minimum Excludant）运算的定义与性质

- **Mex运算的定义**：
  - 在Nim游戏中，Mex运算是计算Nim值的关键工具。它的作用是找到一个集合中**缺失的最小非负整数**。假设我们有一个非负整数集合 $S$，则该集合的Mex值表示为
    $$
    \text{mex}(S) = \min \{ x \in \mathbb{N} \cup \{0\} : x \notin S \}
    $$
    其中 $\mathbb{N} \cup \{0\}$ 表示非负整数集。Mex值是从集合 $S$ 中**缺失的最小非负整数**。

- **Mex运算的具体示例**：
  - Mex是一个很简单的运算，下面通过几个例子进一步说明：
    - 如果 $S = \{0, 1, 3\}$，则 $\text{mex}(S) = 2$，因为2是集合 $S$ 中缺失的最小非负整数。
    - 如果 $S = \{1, 2, 3\}$，则 $\text{mex}(S) = 0$，因为0是集合 $S$ 中缺失的最小非负整数。
    - 如果 $S = \{0, 1, 2, 4\}$，则 $\text{mex}(S) = 3$，因为3是集合 $S$ 中缺失的最小非负整数。

Mex运算在Nim游戏中非常重要，它帮助我们计算复杂局面的Nim值。

---

#### 4. Nim值的递推公式与推导

- **递推关系**：
  - 假设局面 $G$ 有若干个可能的后续状态（记作 $G_1, G_2, \dots, G_m$），即通过一次操作可以从 $G$ 转换到这些后续状态之一。此时，$G$ 的Nim值 $N(G)$ 可以通过其所有后续状态的Nim值集合计算得出。
  
  - 公式表示为
    $$
    N(G) = \text{mex}(N(G_1), N(G_2), \dots, N(G_m))
    $$
    该公式表示的是：$G$ 的Nim值是所有后续状态的Nim值的Mex值，即找到后续状态Nim值集合中的“缺失的最小非负整数”。

- **推导解释**：
  - 假设我们已知每个后续局面的Nim值，那么可以通过找出这些Nim值集合中最小的缺失非负整数来定义当前局面的Nim值。
  - 这个公式的含义是：若当前局面可以变成多个不同的局面（如 $G_1, G_2, \dots, G_m$），那么其Nim值应该是这些局面的Nim值中缺失的最小非负整数。
  
- **边界条件**：
  - 当 $G$ 无任何操作选择（即无后续状态）时，$N(G) = 0$。这意味着，如果没有合法的操作，那么该局面即为“输局”。

---

#### 5. 实例：通过DAG计算Nim值

DAG（有向无环图）模型通常用于表示Nim游戏中的各种局面及其转移关系。我们可以利用递推公式，通过逐层递推计算DAG中每个节点的Nim值，从而确定每个局面的胜负情况。

以下是几个典型例子：

- **例1**：无选项节点（基准条件）
  - 若节点 $G_i$ 没有任何后续节点，则 $N(G_i) = 0$，因为此局面无可选择操作。
  - 表示为
    $$
    N(G_i) = 0
    $$

- **例2**：单个选项节点
  - 若节点 $G_j$ 有一个后续节点 $G_i$，并且 $N(G_i) = 0$，则 $N(G_j) = \text{mex}(\{0\}) = 1$。
  - 具体表示为
    $$
    N(G_j) = \text{mex}( \{ N(G_i) \} ) = \text{mex}(\{0\}) = 1
    $$

- **例3**：两个选项节点
  - 若节点 $G_k$ 有两个后续节点，分别为 $G_i$ 和 $G_j$，其中 $N(G_i) = 0$ 和 $N(G_j) = 1$，则 $N(G_k) = \text{mex}(\{0, 1\}) = 2$。
  - 表示为
    $$
    N(G_k) = \text{mex}( \{ N(G_i), N(G_j) \} ) = \text{mex}(\{0, 1\}) = 2
    $$

- **例4**：三个选项节点
  
  - 若节点 $G_l$ 有三个后续节点，分别为 $G_i, G_j, G_k$，其中 $N(G_i) = 0$，$N(G_j) = 1$，$N(G_k) = 2$，则 $N(G_l) = \text{mex}(\{0, 1, 2\}) = 3$。
  - 表示为
    
  

$$
N(G_l) = \text{mex}( \{ N(G_i), N(G_j), N(G_k) \} ) = \text{mex}(\{0, 1, 2\}) = 3
$$
通过这一过程，可以递推得到DAG中各节点（局面）的Nim值，从而明确每个局面的胜负情况。

---

#### 6. 完整的Nim值递推公式

总结上述内容，可以得到Nim值的完整递推公式：

$$N(G) = 
\begin{cases}
    0, & \text{if $G$ has no options (i.e., terminal node)} \\
    \text{mex}(N(G_1), N(G_2), \dots, N(G_m)), & \text{if $G$ has options $G_1, G_2, \dots, G_m$}
\end{cases}$$

- **解释**：该公式表示每个局面的Nim值可以递推自其后续局面的Nim值，通过Mex运算找出最小缺失的非负整数，从而推导出递推关系。

---

### 总结与应用

- **Nim值与胜负判定**：Nim值大于0的局面为赢局，等于0的局面为输局。
- **Nim值递推的实用性**：通过Nim值公式，可以在复杂组合博弈中逐层推导各状态的胜负，并设计出基于最优策略的算法。
- **理论扩展**：Mex与Nim值递推不仅适用于简单的Nim游戏，还可以推广到复杂的有向无环图结构和其他类型的组合博弈。

---

### 思考与拓展问题

- **如何将Nim值扩展应用到循环图（非DAG）结构的博弈模型中？**
- **在多堆Nim游戏中，如何通过Nim值计算得出合适的最优操作？**
- **若引入多玩家或合作博弈，是否能继续应用Nim值与Mex规则？**

掌握这些公式与推导有助于深入理解组合博弈理论和最优策略设计。