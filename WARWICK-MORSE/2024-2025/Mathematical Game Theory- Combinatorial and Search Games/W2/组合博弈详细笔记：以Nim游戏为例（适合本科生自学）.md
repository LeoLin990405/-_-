### 组合博弈详细笔记：以Nim游戏为例（适合本科生自学）

---

#### 1. 组合博弈的基本概念

**组合博弈**是一种数学模型，用来描述两人轮流在一组规则下行动的情形。在组合博弈中，游戏有明确的规则，并且在有限的步数后会结束，没有随机性。它具备以下特点：

1. **两人交替行动**：游戏有两位玩家（我们称之为玩家I和玩家II），他们轮流进行操作。
2. **确定性规则**：每个状态下的可能操作都被严格定义，不存在随机事件。
3. **有限步数结束**：每场游戏都在有限步数内终止，游戏不会无限循环或平局。
4. **正常玩法规则**：通常情况下，如果轮到某个玩家时，他无法进行合法操作，则该玩家失败。
5. **无随机性**：游戏中没有掷骰子、洗牌等随机因素，所有信息对双方完全公开，因此适合进行数学建模与分析。

组合博弈广泛应用于研究博弈策略与数学推理。为了便于理解组合博弈的分析方法，我们以经典的组合博弈——Nim游戏为例，介绍其规则、策略以及数学推导。

---

#### 2. Nim游戏的基本规则

Nim游戏是一种经典的组合博弈，规则简单却蕴含深刻的策略原理。Nim游戏的规则如下：

- **游戏状态**：Nim游戏的状态可以用若干堆（heap）来表示，每堆中有一定数量的火柴或筹码。例如，状态 $(3, 4, 5)$ 表示三堆火柴，分别有3、4和5根火柴。
- **合法操作**：每位玩家在回合中可以选择一个堆，从中移除任意数量的火柴（至少一根，至多移除该堆中所有火柴）。每次只能对一个堆进行操作。
- **游戏结束**：当轮到某位玩家行动时，若所有堆都已为空，则该玩家无法进行操作，因而失败，另一位玩家获胜。

##### 例子：Nim游戏的状态 $(1, 2, 3)$ 的可能移动

假设当前状态为 $(1, 2, 3)$，即三个堆中分别有1、2和3根火柴。此时玩家可以进行以下几种操作：

1. 从第一堆中移除1根火柴，得到状态 $(0, 2, 3)$；
2. 从第二堆中移除1根火柴，得到状态 $(1, 1, 3)$；
3. 从第二堆中移除2根火柴，得到状态 $(1, 0, 3)$；
4. 从第三堆中移除1根火柴，得到状态 $(1, 2, 2)$；
5. 从第三堆中移除2根火柴，得到状态 $(1, 2, 1)$；
6. 从第三堆中移除3根火柴，得到状态 $(1, 2, 0)$。

这些新状态称为当前状态的**选择**，即从当前状态出发，通过一次合法操作可以到达的所有状态。

---

#### 3. 赢的状态与输的状态

在组合博弈中，我们可以将游戏状态分为**赢的状态**和**输的状态**。这种划分能够帮助我们理解博弈的最终结果以及每一步的最优决策。

1. **输的状态（Losing Position）**：如果从当前状态出发，任何移动都会导致对手进入赢的状态，那么该状态为输的状态。也就是说，处于输的状态的玩家，无论如何行动，都会输。
2. **赢的状态（Winning Position）**：如果从当前状态出发，存在至少一种移动可以使对手进入输的状态，那么该状态为赢的状态。也就是说，处于赢的状态的玩家可以通过合理的策略保证获胜。

##### 例子：分析状态 $(1, 2, 3)$ 的胜负情况

假设当前状态为 $(1, 2, 3)$，我们计算该状态的所有可能移动，发现无论如何操作，都会让对手进入赢的状态。因此 $(1, 2, 3)$ 是一个输的状态。这表明，如果当前玩家在 $(1, 2, 3)$ 状态并且对手采取最优策略，那么当前玩家最终会失败。

---

#### 4. 游戏的和与等价性

在组合博弈中，两个或多个游戏可以合并成一个新游戏，这种操作称为**和**。游戏的**和**以及**等价性**在组合博弈的分析中非常重要。

- **和的定义**：给定两个组合博弈 $G$ 和 $H$，它们的和 $G + H$ 表示在每轮中，玩家可以选择在 $G$ 或 $H$ 中进行移动，而不影响另一个游戏的状态。
- **等价性**：如果对于任意的第三个游戏 $J$，两个游戏 $G$ 和 $H$ 满足 $G + J$ 和 $H + J$ 的输赢结果相同，则称 $G$ 和 $H$ 等价，记作 $G \equiv H$。

##### 关键推论
若某个游戏 $G$ 是“输的状态”，则它等价于一个大小为0的Nim堆，记作 $*0$，即 $G \equiv *0$。换句话说，如果 $G \equiv *0$，那么 $G$ 在任意和中表现如同一个空堆，不会改变其他状态的输赢特性。

---

#### 5. Nim游戏的二进制表示法与Nim和（Nim-Sum）

在Nim游戏中，使用**二进制表示法**和**Nim和**（Nim-Sum）可以帮助我们快速判断一个状态是赢的状态还是输的状态。具体方法如下：

1. **二进制表示法**：将每个堆的大小表示为二进制数。例如，若堆的大小为5，其二进制表示为 $101$。
2. **Nim和（⊕运算）**：将每个堆的二进制表示逐位进行“无进位加法”（XOR），得到的结果称为Nim和。如果Nim和为0，则该状态为输的状态；若Nim和不为0，则该状态为赢的状态。

##### 公式推导

假设当前状态由 $n$ 个堆组成，堆的大小分别为 $a_1, a_2, \dots, a_n$。我们将这些堆的大小以二进制表示，并逐位进行XOR运算：

$$
\text{Nim和} = a_1 \oplus a_2 \oplus \cdots \oplus a_n
$$

其中 $\oplus$ 表示逐位异或操作。

1. **如果Nim和为0**：即 $a_1 \oplus a_2 \oplus \cdots \oplus a_n = 0$，则当前状态为输的状态。
2. **如果Nim和不为0**：则当前状态为赢的状态，当前玩家可以通过某种操作使得对手进入输的状态。

##### 例子：计算状态 $(5, 11, 8)$ 的Nim和

假设当前状态为 $(5, 11, 8)$，我们将每个堆的大小转换为二进制表示：

- $5 = 0101$
- $11 = 1011$
- $8 = 1000$

然后逐位异或：

$$
5 \oplus 11 \oplus 8 = 0101 \oplus 1011 \oplus 1000 = 0110
$$

结果为 $0110$，即十进制数6。因为Nim和不为0，说明当前状态为赢的状态。当前玩家可以通过合理的操作使Nim和为0，从而将对手置于输的状态。

##### 总结Nim和规则
- **Nim和为0**：状态为输的状态。
- **Nim和不为0**：状态为赢的状态，当前玩家可以通过调整某个堆，使得对手进入输的状态。

---

#### 6. 主定理：每个Nim堆的唯一二进制表示

**Nim游戏的主定理**指出，每个Nim堆的大小可以唯一地分解为若干不重复的2的幂之和。这一性质对分析复杂Nim游戏提供了理论基础。

##### 定理表达

任意正整数 $n$ 可以唯一表示为若干不同的2的幂之和：

$$
n = 2^{a} + 2^{b} + 2^{c} + \cdots
$$

其中

 $a > b > c > \cdots \geq 0$。

例如：
- $5 = 4 + 1 = 2^2 + 2^0$
- $11 = 8 + 2 + 1 = 2^3 + 2^1 + 2^0$

这种唯一分解可以将复杂的Nim状态转换为若干个单独的2的幂之和，简化了胜负判断。

---

#### 7. 最优策略和操作推导

在Nim游戏中，判断状态的胜负后，关键在于找到最佳策略。具体策略基于Nim和结果的推导：

1. **Nim和为0的情况**：如果当前状态的Nim和为0，则该状态为输的状态。当前玩家处于不利地位，除非对手失误，否则将会失败。
2. **赢的移动**：如果Nim和不为0，当前玩家可以选择一个堆，通过调整该堆的大小使Nim和变为0，这样可以将状态转化为对手的输的状态。

##### 实例推导：状态 $(5, 11, 8)$ 的最优移动

假设当前状态为 $(5, 11, 8)$，计算其Nim和为6。为了获胜，当前玩家可以通过调整某一堆使得Nim和为0。具体步骤如下：

1. **逐位对比**：将Nim和 $0110$ 与每个堆的二进制表示对比。
2. **选择适当的堆**：例如可以将堆5调整为3（即 $5 \to 3$），得到新状态 $(3, 11, 8)$。

在该状态下的Nim和为0，因此新的状态为输的状态，对手将处于不利地位。

---

#### 8. 进一步扩展：Nim游戏的等价和多堆游戏的分析

在Nim游戏中，我们可以将不同的堆组合起来分析其等价性和和的策略。利用Nim和的特性，可以将任意复杂的组合博弈问题转化为简单的等价问题，从而在复杂博弈中找到最优策略。

通过掌握以上概念，结合Nim和的技巧，可以为各类组合博弈设计有效的胜利策略。这些方法不仅适用于Nim游戏，还可推广至其他无偏博弈。